{% extends 'base.html' %}

{% block title %} Index {% endblock %}

{% block head %}

<link rel="stylesheet" href="{{ url_for('static', filename='Attendance.css') }}">
<script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
  crossorigin="anonymous"></script>

<script>

function submitAttendance(emp_id) {
  var q = '#' + emp_id;
  
  var row = $(q);
  present_count = row.find('input[type="checkbox"]').filter(':checked').length;

  $.ajax({
    type: 'POST',
    url: "{{ url_for('update_attendance') }}",
    contentType: "application/json",
    data: {"emp_id": emp_id, "present_count": present_count },
    success: function(response) {
      window.location.replace("{{url_for('attendance')}}")
    }
  });
}

</script>

{% endblock %}

{% block content %}

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
    <div class="w3-panel w3-{{ category }}" role="alert"> {{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<h1 style="align-items: center;"><b>Employee Attendance</b></h1>

<div class="scrollmenu">
    <!--Repeater -->

    <table id="attendanceTable" class="contentCenter">
        <thead>
          <tr>
            <th class="name-col">Employee Name</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4</th>
            <th>5</th>
            <th>6</th>
            <th>7</th>
            <th>8</th>
            <th>9</th>
            <th>10</th>
            <th>11</th>
            <th>12</th>
            <th>13</th>
            <th>14</th>
            <th>15</th>
            <th>16</th>
            <th>17</th>
            <th>18</th>
            <th>19</th>
            <th>20</th>
            <th>21</th>
            <th>22</th>
            <th>23</th>
            <th>24</th>
            <th>25</th>
            <th>26</th>
            <th>27</th>
            <th>28</th>
            <th>29</th>
            <th>30</th>
            <th>31</th>
            <th class="present-col">Present</th>
          </tr>
        </thead>
        <tbody>
          {% for empAttendance in empAttendances %}  <!--Start loop to take the data from the database -->

          <tr id="{{empAttendance.emp_id}}" class="student">

            <td> {{ empAttendance.first_name + ' ' + empAttendance.last_name }}</td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="1-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="2-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="3-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="4-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="5-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="6-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="7-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="8-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="9-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="10-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="11-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="12-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="13-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="14-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="15-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="16-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="17-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="18-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="19-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="20-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="21-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="22-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="23-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="24-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="25-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="26-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="27-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="28-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="29-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="30-{{empAttendance.emp_id}}"></td>
            <td class="attend-col"><input class="w3-check" type="checkbox" name="31-{{empAttendance.emp_id}}"></td>
            <td id="attendance{{empAttendance.attendance}}" class="present-col w3-text-green">{{empAttendance.attendance}}</td>
            <td class="submit-col">
                <!-- <input type="submit" id="submit{{empAttendance.emp_id}}", value="submit"> -->
                <button onclick="submitAttendance('{{empAttendance.emp_id}}')">Update</button>
            </td>

          </tr>
          {% endfor %} <!--End loop -->
        </tbody>
      </table>

</div>






{% endblock %}